# ロボットアームアニメーション改善記録

## 実装日時
2026-01-19

## 改善内容

### 1. 多関節構造の実装
- **3セグメント構造**：ベース、下部アーム（肩から肘）、上部アーム（肘から手首）、グリッパー
- **関節の独立動作**：各関節が独立して回転し、全体として滑らかな動作を実現
- **産業用ロボットアーム風のデザイン**：
  - 金色（#FFD700）とオレンジ（#FFA500）の配色
  - 油圧シリンダー風のディテール（縦線）
  - 関節部分に円形のジョイント（大きい円と小さい円の二重構造）
  - グリッパーは灰色（#696969）で、左右2つのパーツ

### 2. 現実的な動作シーケンス
アニメーションは10秒ループで、以下のフェーズに分かれています：

#### 1台目のアーム（包装紙を引く）
- **待機位置**（0-35%）：直立状態
- **下降開始**（35%）：肩関節 -35°、肘関節 -45°、手首関節 -20°に回転
- **掴む**（40%）：グリッパーが閉じる（scaleX: 0.5）
- **作業**（40-45%）：包装紙を引くエフェクト（茶色の長方形が表示）
- **戻る**（45-50%）：元の直立位置に戻る

#### 2台目のアーム（リボンを付ける）
- **待機位置**（0-40%）：直立状態
- **下降開始**（40%）：肩関節 -15°、肘関節 -25°、手首関節 10°に回転
- **掴む**（43%）：グリッパーが閉じる（scaleX: 0.5）
- **作業**（43-48%）：リボンを付けるエフェクト（青い円が表示）
- **戻る**（48-50%）：元の直立位置に戻る

### 3. 失敗状態の表現
サイバーセキュリティが機能しない場合：
- ロボットアームは直立状態で停止
- 💤エフェクトが上昇しながらフェードアウト（2秒ループ）
- 2台目のアームは0.5秒遅れて💤エフェクトを表示

### 4. タイミングの同期
- お饅頭の移動：40%で包装ゾーンに到達
- 1台目のアーム：35-50%で動作（包装紙を引く）
- 2台目のアーム：40-50%で動作（リボンを付ける）
- お饅頭の状態変化：40-45%で包装/腐敗が決定

## 技術的な詳細

### SVG構造
```
<svg>
  <g> ベース台座 </g>
  <motion.g> 肩関節を中心に回転
    <g> 下部アーム </g>
    <motion.g> 肘関節を中心に回転
      <g> 上部アーム </g>
      <motion.g> 手首関節を中心に回転
        <circle> 手首ジョイント </circle>
        <motion.g> グリッパー（開閉） </motion.g>
        <motion.g> 作業エフェクト </motion.g>
      </motion.g>
    </motion.g>
  </motion.g>
</svg>
```

### Framer Motionのアニメーション設定
- **duration**: 10秒（全体のループ時間）
- **times配列**: [0, startTime - 0.05, startTime, startTime + 0.03, endTime, endTime + 0.05]
- **ease**: 'easeInOut'（滑らかな加減速）
- **repeat**: Infinity（無限ループ）

### 回転の中心点（transformOrigin）
- 肩関節: '50px 140px'（ベース上部）
- 肘関節: '50px 85px'（下部アーム上端）
- 手首関節: '50px 40px'（上部アーム上端）
- グリッパー: '50px 35px'（手首ジョイント下）

## ビジュアル改善点

### 産業用ロボットアームらしさ
1. **関節の可視化**：各関節に円形のジョイントを配置
2. **油圧シリンダー風のディテール**：アーム本体に縦線を追加
3. **色の階層**：ベース（濃い灰色）→ アーム（金色）→ グリッパー（灰色）
4. **グリッパーの構造**：左右対称の2つのパーツ、内側に横線のディテール

### 作業エフェクト
- **包装紙を引く**：茶色の長方形が下に移動
- **リボンを付ける**：青い円がスケールアップ

## コンポーネント構造

```typescript
FactoryAnimation()  // シナリオ選択UI + 説明文
  └─ FactoryAnimationCore({ scenario })  // メインアニメーション
      ├─ WorkerArea({ mood, animationKey })
      │   └─ Worker({ mood, animationKey, withHand })
      ├─ ConveyorBelt()
      ├─ RobotArms({ working, animationKey })
      │   ├─ ArticulatedRobotArm({ working, animationKey, taskType: 'wrapping', startTime: 0.35 })
      │   └─ ArticulatedRobotArm({ working, animationKey, taskType: 'ribbon', startTime: 0.40 })
      └─ Manju({ isGood, cyberWorking, animationKey })
```

## 今後の改善案
- [ ] ロボットアームの影を追加
- [ ] グリッパーの開閉時に音を追加（オプション）
- [ ] お饅頭を掴む瞬間のエフェクトを強化
- [ ] 包装紙とリボンの3D感を向上
- [ ] アームの動きにモーションブラーを追加（パフォーマンスに注意）
