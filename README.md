# Concordia Shrine

> 「ヒューマンセキュリティなくしてサイバーセキュリティは実現しない」

対話の「空気」を可視化し、判断の自由をそっと守る祠プロダクト。

## コンセプト

Concordia Shrineは、会議やミーティングにおける「見えない圧力」を可視化するWebアプリケーションです。

### 守りたいもの

- **「はい」と言ってしまう0.5秒前の、まだ自由な心**
- **気まずさや沈黙のせいで飲み込まれてしまう違和感**
- **場の空気に押し流される前の「本当はこう思っている」の可能性**

### Human Decision Security

従来のセキュリティは、データやネットワークを守ることに焦点を当ててきました。

しかし、Concordia Shrineは「人の判断の自由」を守ることを目指します。

技術的な防御（サイバーセキュリティ）が、心理的な安全（ヒューマンセキュリティ）を支え、
その逆もまた真なのです。

## 機能

### 空気の可視化

- **波の生成**: Perlin Noiseベースの有機的な波が、対話の「空気」をリアルタイムで表現
- **シーン判定**: 静寂、調和、一方的、沈黙の4つの状態を自動検出
- **セキュリティバリア**: 画面端の光が「結界」として、保護状態を視覚化

### 介入機能

- **リアルタイム検知**: 「一方的」や「沈黙」状態が続くと自動で検知
- **穏やかな通知**: 通知音とヒントメッセージで、参加者に気づきを促す
- **カスタマイズ可能**: 介入のタイミングや方法を設定可能

### レポート出力

- **セッション分析**: 対話の傾向やセキュリティスコアを分析
- **Markdown/HTML出力**: 振り返りに活用できるレポートを生成

### 気づかないうちに守られている

以下のセキュリティ機能が、ユーザーが意識することなくバックグラウンドで動作しています：

| 機能 | 説明 |
|------|------|
| **暗号化** | セッションデータはAES-256-GCMで暗号化 |
| **レート制限** | 異常なアクセスパターンを自動ブロック |
| **入力サニタイズ** | XSS/SQLインジェクション対策 |
| **監査ログ** | セキュリティイベントを自動記録 |
| **CSRF保護** | フォーム送信時のトークン検証 |
| **プロンプトインジェクション対策** | LLMへの悪意ある指示を検出・ブロック（AI時代の脅威対策） |
| **出力データ検証** | 機密情報の漏洩を防止（モデル反転攻撃対策） |

ログインユーザーは「詳細」ボタンから、これらの守護者たちの働きを確認できます。

#### AI時代のセキュリティ対策

Concordia Shrineは、AI時代特有の脅威にも対応しています：

- **プロンプトインジェクション対策**: LLMに悪意ある指示を紛れ込ませる攻撃を検出・ブロック
- **モデル反転攻撃対策**: AIの出力から機密情報が漏洩しないよう検証
- **データポイズニング対策**: 外部データの信頼性を検証
- **シャドウモデル対策**: モデル出力の異常検知（出力形式の検証とベースライン比較）

これらの対策により、AIを活用する際のセキュリティリスクを最小化しています。

#### Webアプリケーションのセキュリティ対策

Concordia Shrineは、OWASP Top 10などの一般的なWebアプリケーションのセキュリティ脅威にも対応しています：

- **SQLインジェクション対策**: DynamoDBを使用することでSQLインジェクションのリスクを排除
- **XSS対策**: 入力値のサニタイズとエスケープ処理
- **CSRF対策**: nonce検証とCORSチェックによる二重防御
- **認証・認可の不備対策**: リソースベースのアクセス制御（verifyAccess）
- **IDOR対策**: リソース所有者の検証とadmin権限チェック
- **セッションハイジャック対策**: セッション固定攻撃の検出、セッションタイムアウト検証
- **CORSの誤設定対策**: CORS設定の検証とワイルドカード使用の警告
- **ファイルアップロード脆弱性対策**: ファイルタイプ検証、サイズ制限、危険な拡張子のブロック
- **ディレクトリトラバーサル対策**: パストラバーサルパターンの検出とパス正規化
- **セキュリティ設定ミス対策**: 環境変数の起動時検証

これらの対策により、Webアプリケーションとしてのセキュリティを多層的に保護しています。

## 技術スタック

- **フロントエンド**: React 19 + TypeScript + Tailwind CSS 4
- **バックエンド**: Express + tRPC
- **データベース**: AWS DynamoDB
- **認証**: OAuth 2.0 + JWT
- **波生成**: Perlin Noise Algorithm
- **音声分析**: Web Audio API + Web Speech API

## 開発

### セットアップ

```bash
# 依存関係のインストール
pnpm install

# DynamoDBテーブルの作成
# AWS CLIを使用してテーブルを作成する場合:
./scripts/create-dynamodb-table.sh

# または、AWS CDKを使用してインフラをデプロイする場合:
# cd cdk && cdk deploy

# 環境変数の設定
# .envファイルを作成し、以下の環境変数を設定してください:
# - JWT_SECRET: JWT署名用のシークレットキー（必須）
# - VITE_APP_ID: アプリケーションID（必須）
# - AWS_REGION: AWSリージョン（デフォルト: ap-northeast-1）
# - AWS_ACCESS_KEY_ID: AWSアクセスキーID（AWS CLIまたはIAMロールで認証する場合）
# - AWS_SECRET_ACCESS_KEY: AWSシークレットアクセスキー（AWS CLIまたはIAMロールで認証する場合）
# 
# 注意: AWS認証情報は、AWS CLIの設定（~/.aws/credentials）やIAMロールを使用することもできます。
# 開発環境では、AWS CLIで `aws configure` を実行して認証情報を設定することを推奨します。

# 開発サーバーの起動
pnpm dev

# テストの実行
pnpm test
```

## 哲学

> あなたがこの祠を訪れた瞬間、見えない結界が展開されました。
> 
> それは、あなたが気づくことなく、静かに、しかし確実に動き始めています。
> 
> あなたの言葉を守り、あなたの判断の自由を守り、あなたが安心して対話できる空間を創り出すために。
> 
> これは、技術が人を守る物語です。

詳しくは [システムアーキテクチャ詳細](docs/architecture.md) をご覧ください。

## ライセンス

MIT License

---

Concordia Shrine — Human Decision Security
